<?php
use App\Http\Controllers\MenuController;
use App\Models\Cohort;
use App\Repositories\MenuRepository;
use Illuminate\Support\Facades\Route;
Route::get('/', function (MenuRepository $menus) {
    $device = request()->header('X-Device', 'desktop');
    return view('welcome', [
        'mainMenu' => $menus->getTree('main', 'header', $device),
        'device' => $device,
    ]);
});
Route::get('/menus/{slug}/{location}', [MenuController::class, 'show']);
Route::get('/cohorts/{cohort:slug}', function (Cohort $cohort, MenuRepository $menus) {
    $device = request()->header('X-Device', 'desktop');
    return view('cohorts.show', [
        'cohort' => $cohort->load(['students', 'teachers', 'resources', 'assignments', 'discussions.replies', 'events']),
        'mainMenu' => $menus->getTree('main', 'header', $device),
        'device' => $device,
    ]);
});

// OAuth Social Login Routes
Route::prefix('auth')->group(function () {
    // Facebook
    Route::get('facebook', [App\Http\Controllers\Auth\SocialAuthController::class, 'redirectToFacebook'])
        ->name('auth.facebook');
    Route::get('facebook/callback', [App\Http\Controllers\Auth\SocialAuthController::class, 'handleFacebookCallback'])
        ->name('auth.facebook.callback');
    
    // Google
    Route::get('google', [App\Http\Controllers\Auth\SocialAuthController::class, 'redirectToGoogle'])
        ->name('auth.google');
    Route::get('google/callback', [App\Http\Controllers\Auth\SocialAuthController::class, 'handleGoogleCallback'])
        ->name('auth.google.callback');
});

// OAuth Social Login Routes
Route::prefix('auth')->group(function () {
    // Facebook
    Route::get('facebook', [App\Http\Controllers\Auth\SocialAuthController::class, 'redirectToFacebook'])
        ->name('auth.facebook');
    Route::get('facebook/callback', [App\Http\Controllers\Auth\SocialAuthController::class, 'handleFacebookCallback'])
        ->name('auth.facebook.callback');
    
    // Google
    Route::get('google', [App\Http\Controllers\Auth\SocialAuthController::class, 'redirectToGoogle'])
        ->name('auth.google');
    Route::get('google/callback', [App\Http\Controllers\Auth\SocialAuthController::class, 'handleGoogleCallback'])
        ->name('auth.google.callback');
});